# План внедрения асинхронности: Celery + Redis

Этот план описывает процесс интеграции фоновых задач в проект OnlineDukan. Это критически важный шаг для перехода на уровень Senior, так как он делает систему отказоустойчивой и масштабируемой.

## Цели
1. **Повышение скорости ответа (Latency):** Пользователь не должен ждать завершения медленных операций (например, отправки уведомлений).
2. **Отказоустойчивость (Reliability):** Если внешнее API (Telegram) временно недоступно, задача должна автоматически повториться позже.
3. **Разделение ответственности:** Веб-сервер занимается HTTP, а воркеры (Celery) — тяжелыми задачами.

---

## Шаг 1: Инфраструктура (Redis)
**Что:** Добавление Redis в качестве брокера сообщений.
**Инструмент:** `docker-compose.yml`.
**Зачем:** Брокер — это "почтовый ящик", куда Django будет складывать задачи, а Celery — забирать их.

## Шаг 2: Настройка Celery в Django
**Что:** Создание файла `core/celery.py` и интеграция с `core/__init__.py`.
**Зачем:** Чтобы Django знал, как подключаться к Celery и где искать задачи.

## Шаг 3: Создание фоновых задач
**Что:** Создание файла `shop/tasks.py`.
**Первая задача:** `send_order_notification_task`.
**Зачем:** Перенос логики отправки Telegram-уведомления из основного потока в фоновый.

## Шаг 4: Интеграция с Service Layer
**Что:** Вызов задачи внутри `shop/services.py` через метод `.delay()`.
**Зачем:** Это сохраняет архитектуру чистой. Сервис создает заказ и "заказывает" уведомление в фоне.

## Шаг 5: Отказоустойчивость (Retry Strategy)
**Что:** Настройка автоматических ретраев для задач.
**Пример:** `autoretry_for=(Exception,), retry_kwargs={'max_retries': 5}, retry_backoff=True`.
**Зачем:** Чтобы временные сбои в сети или в Telegram API не приводили к потере уведомлений.

---

## Почему это важно для грейда Senior?
- **Распределенные системы:** Ты показываешь, что умеешь работать с параллельными процессами.
- **Инженерное мышление:** Ты думаешь о худшем сценарии (Telegram упал) и закладываешь механизмы восстановления.
- **Производительность:** Ты борешься за каждую миллисекунду времени ответа для пользователя.

> [!TIP]
> Внедрение Celery — это стандарт индустрии для любых Enterprise-систем. Теперь твой проект будет готов к высоким нагрузкам.
